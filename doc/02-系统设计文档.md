# 博客系统设计文档

## 1. 系统概述

### 1.1 系统名称
**Coke Blog V2** - 现代化个人博客系统

### 1.2 设计目标
- 提供优雅的阅读和写作体验
- 支持传统写作和 AI 辅助创作
- 确保系统安全性和可扩展性
- 优化性能和用户体验

### 1.3 技术架构
```
┌──────────────────────────────────────────────────────────────┐
│                        Client Layer                          │
│  React 18 + TypeScript + Tailwind CSS + React Router         │
└────────────────────┬─────────────────────────────────────────┘
                     │ HTTP/HTTPS (REST API)
┌────────────────────▼─────────────────────────────────────────┐
│                     Backend Layer                             │
│         Express + TypeScript + TypeORM + JWT Auth             │
└────────────────────┬─────────────────────────────────────────┘
                     │ MySQL Protocol
┌────────────────────▼─────────────────────────────────────────┐
│                    Database Layer                             │
│                   MySQL 8.0+ (InnoDB)                         │
└──────────────────────────────────────────────────────────────┘
```

## 2. 数据库设计

### 2.1 E-R 图关系

```
┌─────────┐        ┌─────────┐        ┌──────────┐
│  User   │1──────N│  Post   │N──────N│   Tag    │
└─────────┘        └─────────┘        └──────────┘
                        │N
                        │
                        │1
                   ┌────▼──────┐
                   │ Category  │
                   └───────────┘
```

### 2.2 数据表设计

#### 用户表 (users)
```sql
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
  email VARCHAR(100) UNIQUE NOT NULL COMMENT '邮箱',
  password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
  display_name VARCHAR(100) COMMENT '显示名称',
  avatar_url VARCHAR(500) COMMENT '头像URL',
  bio TEXT COMMENT '个人简介',
  role ENUM('admin', 'editor', 'author', 'reader') DEFAULT 'author' COMMENT '用户角色',
  status ENUM('active', 'inactive', 'banned') DEFAULT 'active' COMMENT '账户状态',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  last_login_at TIMESTAMP NULL COMMENT '最后登录时间',

  INDEX idx_email (email),
  INDEX idx_username (username),
  INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

#### 文章表 (posts)
```sql
CREATE TABLE posts (
  id INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255) NOT NULL COMMENT '文章标题',
  slug VARCHAR(255) UNIQUE NOT NULL COMMENT 'URL别名',
  excerpt TEXT COMMENT '文章摘要',
  content LONGTEXT NOT NULL COMMENT '文章内容(Markdown)',
  content_html LONGTEXT COMMENT '文章内容(HTML)',
  cover_color VARCHAR(7) DEFAULT '#D6D1CB' COMMENT '封面颜色',
  cover_image VARCHAR(500) COMMENT '封面图片URL',
  category_id INT COMMENT '分类ID',
  author_id INT NOT NULL COMMENT '作者ID',
  read_time INT DEFAULT 0 COMMENT '预计阅读时间(分钟)',
  view_count INT DEFAULT 0 COMMENT '浏览次数',
  like_count INT DEFAULT 0 COMMENT '点赞次数',
  status ENUM('draft', 'published', 'archived') DEFAULT 'draft' COMMENT '发布状态',
  is_featured BOOLEAN DEFAULT FALSE COMMENT '是否为精选文章',
  is_ai_generated BOOLEAN DEFAULT FALSE COMMENT '是否AI生成',
  published_at TIMESTAMP NULL COMMENT '发布时间',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,
  FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE,

  INDEX idx_slug (slug),
  INDEX idx_status (status),
  INDEX idx_published_at (published_at),
  INDEX idx_author_id (author_id),
  INDEX idx_category_id (category_id),
  FULLTEXT idx_search (title, content)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文章表';
```

#### 分类表 (categories)
```sql
CREATE TABLE categories (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(50) UNIQUE NOT NULL COMMENT '分类名称',
  slug VARCHAR(50) UNIQUE NOT NULL COMMENT 'URL别名',
  description TEXT COMMENT '分类描述',
  color VARCHAR(7) DEFAULT '#D97757' COMMENT '分类颜色',
  sort_order INT DEFAULT 0 COMMENT '排序权重',
  post_count INT DEFAULT 0 COMMENT '文章数量',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  INDEX idx_slug (slug)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='分类表';
```

#### 标签表 (tags)
```sql
CREATE TABLE tags (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(50) UNIQUE NOT NULL COMMENT '标签名称',
  slug VARCHAR(50) UNIQUE NOT NULL COMMENT 'URL别名',
  usage_count INT DEFAULT 0 COMMENT '使用次数',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  INDEX idx_slug (slug),
  INDEX idx_usage_count (usage_count)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='标签表';
```

#### 文章标签关联表 (post_tags)
```sql
CREATE TABLE post_tags (
  post_id INT NOT NULL,
  tag_id INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  PRIMARY KEY (post_id, tag_id),
  FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,
  FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE,

  INDEX idx_post_id (post_id),
  INDEX idx_tag_id (tag_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文章标签关联表';
```

#### 刷新令牌表 (refresh_tokens)
```sql
CREATE TABLE refresh_tokens (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  token VARCHAR(500) UNIQUE NOT NULL COMMENT '刷新令牌',
  expires_at TIMESTAMP NOT NULL COMMENT '过期时间',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  INDEX idx_user_id (user_id),
  INDEX idx_token (token),
  INDEX idx_expires_at (expires_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='刷新令牌表';
```

### 2.3 初始数据

```sql
-- 插入默认分类
INSERT INTO categories (name, slug, description, color) VALUES
('AI Safety', 'ai-safety', '探讨人工智能的安全性与伦理问题', '#D97757'),
('Design', 'design', '设计理念与用户体验探索', '#C9C4BC'),
('Research', 'research', '技术研究与学术思考', '#D1D5DB'),
('Culture', 'culture', '文化观察与社会现象', '#CED4C8'),
('Engineering', 'engineering', '工程实践与技术分享', '#DBCDC8');

-- 插入管理员账户 (密码: admin123)
INSERT INTO users (username, email, password_hash, display_name, role) VALUES
('admin', 'admin@example.com', '$2b$10$XYZ...', 'Administrator', 'admin');
```

## 3. API 接口设计

### 3.1 RESTful API 规范

**Base URL**: `http://localhost:3000/api/v1`

**通用响应格式**:
```typescript
// 成功响应
{
  "success": true,
  "data": T,
  "message": "操作成功"
}

// 错误响应
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误描述",
    "details": {...}
  }
}

// 分页响应
{
  "success": true,
  "data": T[],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 100,
    "totalPages": 10
  }
}
```

### 3.2 认证接口

#### POST /auth/register
注册新用户

**请求体**:
```json
{
  "username": "johndoe",
  "email": "john@example.com",
  "password": "password123",
  "displayName": "John Doe"
}
```

**响应**:
```json
{
  "success": true,
  "data": {
    "user": {
      "id": 1,
      "username": "johndoe",
      "email": "john@example.com",
      "displayName": "John Doe"
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
  }
}
```

#### POST /auth/login
用户登录

**请求体**:
```json
{
  "email": "john@example.com",
  "password": "password123"
}
```

#### POST /auth/refresh
刷新访问令牌

**请求体**:
```json
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
}
```

#### POST /auth/logout
用户登出

**Headers**: `Authorization: Bearer {accessToken}`

### 3.3 文章接口

#### GET /posts
获取文章列表

**查询参数**:
- `page`: 页码 (默认: 1)
- `limit`: 每页数量 (默认: 10)
- `status`: 状态筛选 (published/draft/archived)
- `category`: 分类筛选
- `tag`: 标签筛选
- `search`: 关键词搜索
- `sort`: 排序方式 (latest/popular/oldest)

**响应**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "构建可信赖的通用人工智能",
      "slug": "trustworthy-agi",
      "excerpt": "探讨在追求通用人工智能（AGI）的过程中...",
      "coverColor": "#D6D1CB",
      "category": {
        "id": 1,
        "name": "AI Safety",
        "slug": "ai-safety"
      },
      "author": {
        "id": 1,
        "username": "admin",
        "displayName": "张三"
      },
      "tags": ["AI", "Safety"],
      "readTime": 8,
      "viewCount": 1234,
      "likeCount": 56,
      "publishedAt": "2023-10-24T08:00:00Z",
      "createdAt": "2023-10-20T10:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 50,
    "totalPages": 5
  }
}
```

#### GET /posts/:id
获取文章详情

**响应**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "构建可信赖的通用人工智能",
    "content": "# Markdown 内容...",
    "contentHtml": "<h1>HTML 内容...</h1>",
    // ... 其他字段
  }
}
```

#### POST /posts
创建文章 (需认证)

**Headers**: `Authorization: Bearer {accessToken}`

**请求体**:
```json
{
  "title": "文章标题",
  "content": "# Markdown 内容",
  "excerpt": "文章摘要",
  "categoryId": 1,
  "tags": ["AI", "Tech"],
  "coverColor": "#D6D1CB",
  "status": "draft",
  "isAiGenerated": false
}
```

#### PUT /posts/:id
更新文章 (需认证)

#### DELETE /posts/:id
删除文章 (需认证)

#### POST /posts/:id/publish
发布文章 (需认证)

#### POST /posts/:id/like
点赞文章

### 3.4 分类接口

#### GET /categories
获取所有分类

**响应**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "AI Safety",
      "slug": "ai-safety",
      "description": "探讨人工智能的安全性与伦理问题",
      "color": "#D97757",
      "postCount": 15
    }
  ]
}
```

#### POST /categories
创建分类 (需管理员权限)

#### PUT /categories/:id
更新分类 (需管理员权限)

#### DELETE /categories/:id
删除分类 (需管理员权限)

### 3.5 标签接口

#### GET /tags
获取所有标签

#### GET /tags/popular
获取热门标签

### 3.6 AI 辅助接口

#### POST /ai/generate
AI 生成文章

**Headers**: `Authorization: Bearer {accessToken}`

**请求体**:
```json
{
  "topic": "人工智能的未来",
  "style": "academic", // academic/casual/technical
  "length": "medium"   // short/medium/long
}
```

**响应**:
```json
{
  "success": true,
  "data": {
    "title": "关于"人工智能的未来"的深度思考与未来展望",
    "content": "# Markdown 内容...",
    "excerpt": "AI 正在重塑我们的认知边界...",
    "suggestedTags": ["AI", "Future", "Technology"]
  }
}
```

### 3.7 用户接口

#### GET /users/me
获取当前用户信息 (需认证)

#### PUT /users/me
更新当前用户信息 (需认证)

#### GET /users/:id/posts
获取指定用户的文章列表

## 4. 后端架构设计

### 4.1 项目目录结构

```
backend/
├── src/
│   ├── config/              # 配置文件
│   │   ├── database.ts      # 数据库配置
│   │   ├── auth.ts          # 认证配置
│   │   └── app.ts           # 应用配置
│   ├── entities/            # TypeORM 实体
│   │   ├── User.ts
│   │   ├── Post.ts
│   │   ├── Category.ts
│   │   ├── Tag.ts
│   │   └── RefreshToken.ts
│   ├── controllers/         # 控制器
│   │   ├── AuthController.ts
│   │   ├── PostController.ts
│   │   ├── CategoryController.ts
│   │   └── AIController.ts
│   ├── services/            # 业务逻辑服务
│   │   ├── AuthService.ts
│   │   ├── PostService.ts
│   │   ├── CategoryService.ts
│   │   ├── AIService.ts
│   │   └── MarkdownService.ts
│   ├── middlewares/         # 中间件
│   │   ├── auth.ts          # JWT 认证
│   │   ├── validator.ts     # 参数校验
│   │   ├── errorHandler.ts  # 错误处理
│   │   └── rateLimiter.ts   # 限流
│   ├── routes/              # 路由
│   │   ├── auth.routes.ts
│   │   ├── post.routes.ts
│   │   ├── category.routes.ts
│   │   └── index.ts
│   ├── utils/               # 工具函数
│   │   ├── logger.ts
│   │   ├── response.ts
│   │   └── slug.ts
│   ├── types/               # TypeScript 类型定义
│   │   └── index.ts
│   └── app.ts               # Express 应用入口
├── tests/                   # 测试文件
├── .env.example             # 环境变量示例
├── .gitignore
├── package.json
├── tsconfig.json
└── README.md
```

### 4.2 核心中间件流程

```
Request
  │
  ├─→ CORS Middleware
  │
  ├─→ Helmet (Security Headers)
  │
  ├─→ Body Parser
  │
  ├─→ Rate Limiter
  │
  ├─→ Logger
  │
  ├─→ JWT Authentication (if required)
  │
  ├─→ Validator Middleware
  │
  ├─→ Route Handler
  │
  ├─→ Error Handler
  │
  └─→ Response
```

### 4.3 认证流程

```
┌──────┐                  ┌──────────┐                 ┌──────────┐
│Client│                  │  Server  │                 │ Database │
└───┬──┘                  └────┬─────┘                 └────┬─────┘
    │                          │                            │
    │  POST /auth/login        │                            │
    │─────────────────────────>│                            │
    │  {email, password}       │                            │
    │                          │  Query user by email       │
    │                          │───────────────────────────>│
    │                          │                            │
    │                          │  User data                 │
    │                          │<───────────────────────────│
    │                          │                            │
    │                          │  Verify password (bcrypt)  │
    │                          │────────┐                   │
    │                          │        │                   │
    │                          │<───────┘                   │
    │                          │                            │
    │                          │  Generate JWT tokens       │
    │                          │────────┐                   │
    │                          │        │                   │
    │                          │<───────┘                   │
    │                          │                            │
    │                          │  Save refresh token        │
    │                          │───────────────────────────>│
    │                          │                            │
    │  {accessToken, refresh}  │                            │
    │<─────────────────────────│                            │
    │                          │                            │
    │  Subsequent requests     │                            │
    │─────────────────────────>│                            │
    │  Authorization: Bearer   │                            │
    │                          │  Verify JWT                │
    │                          │────────┐                   │
    │                          │        │                   │
    │                          │<───────┘                   │
    │                          │                            │
    │  Response                │                            │
    │<─────────────────────────│                            │
```

### 4.4 JWT Token 策略

**Access Token**:
- 有效期: 15分钟
- 载荷: `{ userId, username, role }`
- 用途: API 请求认证

**Refresh Token**:
- 有效期: 7天
- 存储: 数据库 + HttpOnly Cookie
- 用途: 刷新 Access Token

## 5. 前端架构设计

### 5.1 项目目录结构

```
frontend/
├── public/
│   └── favicon.ico
├── src/
│   ├── assets/              # 静态资源
│   │   ├── fonts/
│   │   └── images/
│   ├── components/          # 公共组件
│   │   ├── common/          # 通用组件
│   │   │   ├── Header.tsx
│   │   │   ├── Footer.tsx
│   │   │   ├── Button.tsx
│   │   │   └── Loading.tsx
│   │   ├── post/            # 文章相关组件
│   │   │   ├── PostCard.tsx
│   │   │   ├── PostList.tsx
│   │   │   └── PostEditor.tsx
│   │   └── layout/          # 布局组件
│   │       └── MainLayout.tsx
│   ├── pages/               # 页面组件
│   │   ├── Home.tsx
│   │   ├── PostDetail.tsx
│   │   ├── CreatePost.tsx
│   │   ├── EditPost.tsx
│   │   ├── Login.tsx
│   │   └── NotFound.tsx
│   ├── services/            # API 服务
│   │   ├── api.ts           # Axios 实例
│   │   ├── authService.ts
│   │   ├── postService.ts
│   │   └── categoryService.ts
│   ├── hooks/               # 自定义 Hooks
│   │   ├── useAuth.ts
│   │   ├── usePosts.ts
│   │   └── useCategories.ts
│   ├── context/             # React Context
│   │   └── AuthContext.tsx
│   ├── utils/               # 工具函数
│   │   ├── formatDate.ts
│   │   ├── slugify.ts
│   │   └── markdown.ts
│   ├── types/               # TypeScript 类型
│   │   └── index.ts
│   ├── styles/              # 全局样式
│   │   └── index.css
│   ├── App.tsx              # 应用根组件
│   ├── main.tsx             # 应用入口
│   └── router.tsx           # 路由配置
├── .env.example
├── .gitignore
├── index.html
├── package.json
├── tailwind.config.js
├── tsconfig.json
├── vite.config.ts
└── README.md
```

### 5.2 路由设计

```typescript
// router.tsx
import { createBrowserRouter } from 'react-router-dom';

export const router = createBrowserRouter([
  {
    path: '/',
    element: <MainLayout />,
    children: [
      {
        index: true,
        element: <Home />
      },
      {
        path: 'posts/:slug',
        element: <PostDetail />
      },
      {
        path: 'categories/:slug',
        element: <CategoryPosts />
      },
      {
        path: 'tags/:slug',
        element: <TagPosts />
      }
    ]
  },
  {
    path: '/create',
    element: <ProtectedRoute><CreatePost /></ProtectedRoute>
  },
  {
    path: '/edit/:id',
    element: <ProtectedRoute><EditPost /></ProtectedRoute>
  },
  {
    path: '/login',
    element: <Login />
  },
  {
    path: '*',
    element: <NotFound />
  }
]);
```

### 5.3 状态管理策略

**React Context + Hooks**:
```typescript
// AuthContext.tsx
interface AuthContextType {
  user: User | null;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
  isAuthenticated: boolean;
  isLoading: boolean;
}

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  // 自动从 localStorage 恢复登录状态
  useEffect(() => {
    const token = localStorage.getItem('accessToken');
    if (token) {
      // 验证 token 并获取用户信息
      authService.me().then(setUser).catch(() => {
        localStorage.removeItem('accessToken');
      }).finally(() => setIsLoading(false));
    } else {
      setIsLoading(false);
    }
  }, []);

  return (
    <AuthContext.Provider value={{ user, login, logout, isAuthenticated, isLoading }}>
      {children}
    </AuthContext.Provider>
  );
};
```

### 5.4 API 请求封装

```typescript
// services/api.ts
import axios from 'axios';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000/api/v1',
  timeout: 10000,
});

// 请求拦截器：添加 JWT Token
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('accessToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// 响应拦截器：处理 401 自动刷新 Token
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;

    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;

      try {
        const refreshToken = localStorage.getItem('refreshToken');
        const { data } = await axios.post('/api/v1/auth/refresh', { refreshToken });

        localStorage.setItem('accessToken', data.accessToken);
        originalRequest.headers.Authorization = `Bearer ${data.accessToken}`;

        return api(originalRequest);
      } catch (refreshError) {
        localStorage.clear();
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }

    return Promise.reject(error);
  }
);

export default api;
```

## 6. 安全设计

### 6.1 认证安全
- **密码存储**: bcrypt (salt rounds: 10)
- **Token 加密**: HS256 (后续升级 RS256)
- **Token 刷新**: Refresh Token Rotation
- **会话管理**: 最多 5 个活跃设备

### 6.2 接口安全
- **Rate Limiting**: 登录接口 5次/分钟，其他 100次/分钟
- **CORS**: 白名单模式
- **XSS 防护**: React 自动转义 + DOMPurify
- **SQL 注入**: TypeORM 参数化查询
- **CSRF**: SameSite Cookie

### 6.3 数据安全
- **敏感信息**: 环境变量存储
- **文件上传**: 类型校验、大小限制、病毒扫描
- **日志脱敏**: 密码、Token 不记录

## 7. 性能优化

### 7.1 前端优化
- **代码分割**: React.lazy + Suspense
- **图片优化**: WebP + 懒加载
- **字体优化**: font-display: swap
- **缓存策略**: Service Worker

### 7.2 后端优化
- **数据库索引**: 高频查询字段
- **查询优化**: 分页、Eager Loading
- **缓存**: Redis 缓存热点数据
- **CDN**: 静态资源 CDN 分发

### 7.3 数据库优化
- **慢查询监控**: MySQL Slow Query Log
- **连接池**: TypeORM 连接池配置
- **读写分离**: 主从复制（后期）

## 8. 监控与日志

### 8.1 日志系统
- **日志库**: Winston
- **日志级别**: error, warn, info, debug
- **日志存储**: 文件 + ELK Stack（生产）

### 8.2 监控指标
- **系统指标**: CPU、内存、磁盘
- **应用指标**: 请求量、响应时间、错误率
- **业务指标**: 文章阅读量、用户活跃度

## 9. 部署方案

### 9.1 Docker 容器化

**docker-compose.yml**:
```yaml
version: '3.8'

services:
  frontend:
    build: ./frontend
    ports:
      - "80:80"
    environment:
      - VITE_API_BASE_URL=http://localhost:3000/api/v1

  backend:
    build: ./backend
    ports:
      - "3000:3000"
    environment:
      - DATABASE_HOST=mysql
      - DATABASE_PORT=3306
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - mysql

  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=${DB_ROOT_PASSWORD}
      - MYSQL_DATABASE=coke_blog
    volumes:
      - mysql_data:/var/lib/mysql
    ports:
      - "3306:3306"

volumes:
  mysql_data:
```

### 9.2 CI/CD 流程

**GitHub Actions**:
```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run tests
        run: npm test

  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to production
        run: |
          docker-compose build
          docker-compose up -d
```

## 10. 测试策略

### 10.1 单元测试
- **后端**: Jest + Supertest
- **前端**: Vitest + React Testing Library
- **覆盖率**: 80% 以上

### 10.2 集成测试
- **API 测试**: Postman/Newman
- **E2E 测试**: Playwright

### 10.3 性能测试
- **压力测试**: Apache JMeter
- **负载测试**: K6

## 11. 后续扩展方向

### 11.1 功能扩展
- [ ] 评论系统
- [ ] 文章版本控制
- [ ] 协作编辑
- [ ] Markdown 编辑器增强
- [ ] 全文搜索（Elasticsearch）
- [ ] RSS 订阅
- [ ] Newsletter 邮件推送

### 11.2 技术升级
- [ ] GraphQL API
- [ ] Server-Side Rendering (Next.js)
- [ ] 微服务架构拆分
- [ ] Redis 缓存层
- [ ] CDN 静态资源加速
- [ ] WebSocket 实时通知

## 12. 开发规范

### 12.1 代码规范
- **ESLint**: Airbnb 规范
- **Prettier**: 统一格式化
- **Commit**: Conventional Commits

### 12.2 Git 工作流
- **主分支**: main
- **开发分支**: develop
- **功能分支**: feature/xxx
- **修复分支**: fix/xxx

### 12.3 文档规范
- **API 文档**: Swagger/OpenAPI
- **组件文档**: Storybook
- **架构文档**: 本文档持续更新

---

**文档版本**: v1.0
**最后更新**: 2024-12-04
**维护者**: Coke Blog Team
